{% load static %}
<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta content="width=device-width, initial-scale=1.0" name="viewport">
    <title>
        {% block title %} {% endblock title %}
    </title>
    <meta content="We deliver your home needs" name="description">
    <link
        href="https://fonts.googleapis.com/css?family=Open+Sans:300,300i,400,400i,600,600i,700,700i|Nunito:300,300i,400,400i,600,600i,700,700i|Poppins:300,300i,400,400i,500,500i,600,600i,700,700i"
        rel="stylesheet">

    <link href="{% static '/assets/vendor/bootstrap-icons/bootstrap-icons.css' %}" rel="stylesheet">

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <script src="https://www.google.com/recaptcha/api.js" async defer></script>

    <!-- Template Main CSS File -->
    <link href="https://preview.colorlib.com/theme/ogani/css/style.css" rel="stylesheet">
    <style>
        a:link {
            text-decoration: none;
        }

        a:focus {
            text-decoration: none;
        }

        a:visited {
            text-decoration: none;
        }

        a:hover {
            text-decoration: none;
        }

        a:active {
            text-decoration: none;
        }

        .alert-success {
            color: #155724;
            background-color: #d4edda;
            border-color: #c3e6cb;
        }
    </style>
</head>

<body class="h-full">
    <header class="header">
        <div class="header__top">
            <div class="container">
                <div class="row">
                    <div class="col-lg-6 col-md-6">
                        <div class="header__top__left">
                            <ul>
                                <li><i class="fa fa-envelope"></i> contact@eShoppy.com</li>
                                <li>Free Shipping for all Order of ₹599</li>
                            </ul>
                        </div>
                    </div>
                    <div class="col-lg-6 col-md-6">
                        <div class="header__top__right ">

                            <div class="header__top__right__auth ">
                                <div class="d-flex justify-content-between">
                                    {% if request.user.is_authenticated %}
                                    <div class="row">
                                        <div class="col-md-9">
                                            <div style="padding-right: 20px;">Hey {{request.user.first_name }}</div>
                                        </div>
                                        <div class="col-md-3">
                                            <a style="cursor: pointer; font-size: 20px;" data-toggle="tooltip"
                                                data-placement="bottom" title="Logout" href="/account/logout/"><i
                                                    class="fa fa-sign-out" aria-hidden="true"></i></a>
                                        </div>


                                    </div>

                                    {% else %}
                                    <a href="/account/login"><i class="fa fa-user"></i> Login</a>
                                    {% endif %}
                                </div>

                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="container">
            <div class="row">
                <div class="col-lg-3">
                    <div class="header__logo">
                        <a style="text-decoration: none;" href="/"> <span
                                style="font-size: 40px; color: #7FAD39; font-weight: 800;"
                                class="e-logo">eShoppy</span></a>

                    </div>
                </div>
                <div class="col-lg-6">
                    <nav class="header__menu">
                        <ul>
                            <li><a href="/">Home</a></li>
                            <li><a href="../../about">About us</a></li>
                            <li><a href="../../team">Our Team</a></li>
                            <li><a href="../../contact">Contact</a></li>
                        </ul>
                    </nav>
                </div>
                <div class="col-lg-3">
                    <div class="header__cart">
                        <ul>
                            <li class="btn btn-primary scrollto cursor-pointer " style="cursor: pointer;" id="popcart"
                                data-container="body" data-toggle="popover" data-placement="bottom" data-html="true"><i
                                    class="fa-solid fa-cart-shopping"></i>
                                Cart (<span id="cart">0</span>)
                            </li>
                            <li onclick="clearCart()" id="clearCart" class="btn btn-warning scrollto cursor-pointer ">
                                Clear Cart</li>
                        </ul>

                    </div>
                </div>
            </div>
            <div class="humberger__open">
                <i class="fa fa-bars"></i>
            </div>
        </div>
    </header>

    <div class="container" style="padding-bottom: 100px;">
        <div class="row">
            <div class="col-lg-3">
                <div class="hero__categories">
                    <div style="padding: 10px; color: #FFF; background-color: #7FAD39;">
                        <span>All departments</span>
                    </div>
                    <ul>
                        <li><a href="/category/fresh-meat">Fresh Meat</a></li>
                        <li><a href="/category/vegetables">Vegetables</a></li>
                        <li><a href="/category/fruits">Fruits</a></li>
                        <li><a href="/category/sea-foods">Ocean Foods</a></li>
                        <li><a href="/category/diary">Diary</a></li>
                        <li><a href="/category/snacks">Snacks</a></li>
                    </ul>
                </div>
            </div>
            <div class="col-lg-9">
                <div class="hero__search">
                    <div class="row">
                        <div class="col-md-9">
                            <input id="searchProduct" placeholder="What do yo u need?" type="text" class="form-control"
                                placeholder="Search">
                        </div>
                        <div class="col-md-3">
                            <button id="searchBtn" type="button" class="btn site-btn">SEARCH</button>
                        </div>
                    </div>
                </div>
                <section>
                    <div>
                        {% block content %}
                        {% endblock content %}
                    </div>
                </section><!-- End Hero -->

                <main id="main" class="topless">
                    {% block body %}
                    {% endblock body %}
                </main><!-- End #main -->
            </div>
        </div>

    </div>

    <footer class="footer spad">
        <div class="container">

            <div class="row">
                <div class="col-lg-12">
                    <div class="footer__copyright">
                        <div class="footer__copyright__text">
                            <p>
                                Copyright ©
                                <script>document.write(new Date().getFullYear());</script>2023 All rights reserved |
                                Nikhil
                            </p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </footer>


    <!-- Vendor JS Files -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js"></script>



    <script>
        $(function () {
            $('[data-toggle="tooltip"]').tooltip()
        })
    </script>






    <script>
        $(document).ready(function () {
            $('input').keydown(function (event) {
                if (event.keyCode == 13) {
                    Category = $("#searchProduct").val();
                    if (Category) {
                        var url = "/search/" + Category;
                        window.location.href = url;
                    }

                }
            });
        });



        $("#searchBtn").click(function () {
            Category = $("#searchProduct").val();
            var url = "/search/" + Category;
            window.location.href = url;
        });
    </script>


    <script>





        //find pout the card from local storage

        if (localStorage.getItem('cart') == null) {
            var cart = {};

        } else {
            cart = JSON.parse(localStorage.getItem('cart'));
            updateCart(cart);

        }
        // add or increment code

        // $('.cart').click(function() {
        $('.divpr').on('click', 'button.cart', function () {
            var idstr = this.id.toString();
            if (cart[idstr] != undefined) {
                qty = cart[idstr][0] + 1;

            } else {
                qty = 1;
                name = document.getElementById('name' + idstr).innerHTML;
                price = document.getElementById('price' + idstr).innerHTML;
                cart[idstr] = [qty, name, price];

            }
            updateCart(cart);

            localStorage.setItem('cart', JSON.stringify(cart));
            document.getElementById('cart').innerHTML = Object.keys(cart).length;
            console.log(Object.keys(cart).length)
            document.getElementById("popcart").click();
        });
        // add pop over to cart



        updatePopover(cart);
        function updatePopover(cart) {
            var popStr = "";
            var popStr = popStr;
            var i = 1;
            for (var item in cart) {
                if (cart[item]) {
                    i = i + 1;
                }

            }

            popStr = popStr + "</div><br/> <a href='/cart'><span class='btn btn-success'>Checkout</span></a> "
            document.getElementById('popcart').setAttribute('data-content', popStr + "");
            $('#popcart').popover('show');
            document.getElementById("popcart").click();
        }

        function clearCart() {
            localStorage.clear();
            window.location.reload()
            cart = {};
            updateCart(cart);

            let clear = document.getElementById("popcart").click();
            document.getElementById("popcart").click();

        }

        function updateCart(cart) {
            var sum = 0;
            for (var item in cart) {
                sum = sum + cart[item][0];
                $(`#div${item}`).html(`
  <button id="minus${item}" class="btn btn-success minus">-</button>
  <span id="val${item}">${cart[item][0]}</span>
  <button id="plus${item}" class="btn btn-success plus">+</button>
`);
            }
            localStorage.setItem('cart', JSON.stringify(cart));
            document.getElementById('cart').innerHTML = sum;
            console.log(cart);
            updatePopover(cart);
            document.getElementById("popcart").click();
        }

        //if plus or minus button is clicked change the cart as well as the display value
        $('.divpr').on("click", "button.minus", function () {

            a = this.id.slice(7,);
            cart['pr' + a][0] = cart['pr' + a][0] - 1;
            cart['pr' + a][0] = Math.max(0, cart['pr' + a][0]);
            document.getElementById('valpr' + a).innerHTML = cart['pr' + a][0];
            updateCart(cart);
        })

        $('.divpr').on("click", "button.plus", function () {
            a = this.id.slice(6,);
            cart['pr' + a][0] = cart['pr' + a][0] + 1;
            document.getElementById('valpr' + a).innerHTML = cart['pr' + a][0];
            updateCart(cart);


        })

        $('#clearCart').click(function () {
            localStorage.clear();
            window.location.reload()
            cart = {};
            updateCart(cart);

            let clear = document.getElementById("popcart").click();
            document.getElementById("popcart").click();

        });



        $("#popcart").click(function () {
            let checkCart = localStorage.getItem("cart")
            if (checkCart.length <= 5) {
                $('.popover').hide();
            } else {
                $('.popover').show();
            }
        });

        $('.popover').hide();

        function openPopUp() {
            let checkCart = localStorage.getItem("cart")
            if (checkCart.length <= 5) {
                $('.popover').hide();
            } else {
                $('.popover').show();
            }
        }

    </script>


</body>

</html>